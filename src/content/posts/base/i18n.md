---
title: "è®¤è¯†å›½é™…åŒ–"
description: "åœ¨ react ä¸­ä½¿ç”¨ i18n å®ç°å›½é™…åŒ–"
pubDate: "2024-07-07 20:54:00"
category: "base"
cardImage: "@images/base/i18n.png"
tags: ["base",'react','i18n']
selected: true
---

## ä»‹ç»

ğŸ’¡ i18næ˜¯â€œinternationalizationâ€çš„ç¼©å†™ï¼Œå…¶ä¸­çš„â€œ18â€ä»£è¡¨äº†å•è¯â€œinternationalizationâ€ä¸­çš„18ä¸ªå­—æ¯ï¼Œå³iåé¢è·Ÿäº†18ä¸ªå­—ç¬¦ã€‚

å›½é™…åŒ–è®¾è®¡ç›®çš„æ˜¯è®©äº§å“èƒ½å¤Ÿè½»æ¾åœ°é€‚åº”ä¸åŒçš„è¯­è¨€å’Œæ–‡åŒ–ç¯å¢ƒã€‚

i18next æ˜¯ä¸€ä¸ªç”¨ JavaScript ç¼–å†™çš„å›½é™…åŒ–æ¡†æ¶ã€‚

## å®‰è£…

é¦–å…ˆç”¨ vite åˆ›å»ºä¸€ä¸ª react é¡¹ç›®

```bash
npm init vite@latest
```

æ¥ç€éœ€è¦å®‰è£… i18next

```bash
pnpm add react-i18next i18next --save
```

## åˆ›å»ºè¯­è¨€åŒ…

ç›®å½•ç»“æ„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```typescript
ğŸ“¦i18n
â”£ ğŸ“¦locales
â”ƒ   â”£ ğŸ“‚en-US
â”ƒ   â”ƒ â”£ ğŸ“œcommon.json
â”ƒ   â”ƒ â”— ğŸ“œauth.json
â”ƒ   â”— ğŸ“‚zh-CN
â”ƒ   â”ƒ â”£ ğŸ“œcommon.json
â”ƒ   â”ƒ â”— ğŸ“œauth.json
â”— ğŸ“œconfig.ts
```

> ä¸Šé¢è¿™ä¸ªç›®å½•ç»“æ„ä¸­ï¼Œ**zh-CN** å’Œ **en-US** ä¿©ç›®å½•ä»£è¡¨ç€æ”¯æŒçš„è¯­è¨€ä»£ç ï¼Œè€Œ **common.js** å’Œ **auth.json** æ˜¯é’ˆå¯¹ç¿»è¯‘çš„å‘½åç©ºé—´åˆ†å‰²ï¼Œè¿™æ˜¯ **i18next** çš„åŠŸèƒ½ï¼Œè¯¦æƒ…è¯·è§[å®˜ç½‘](https://www.i18next.com/principles/namespaces)ã€‚å¸¸è§çš„ç¿»è¯‘å°±æ”¾åˆ° **common.json** é‡Œé¢ï¼Œè€Œé’ˆå¯¹ç”¨æˆ·æˆæƒçš„éƒ½æ”¾åœ¨ **auth.json** è¿™æ ·æ–¹ä¾¿ç®¡ç†

**zh-CN/common.json** å†…å®¹å¦‚ä¸‹ï¼š

```json
{
  "welcome": "æ¬¢è¿æ¥åˆ° React å’Œ react-i18next"
}
```

**en-US/common.json** å†…å®¹å¦‚ä¸‹ï¼š

```json
{
  "welcome": "Welcome to React and react-i18next"
}
```

## åˆå§‹åŒ– i18nnext

config.ts å†…å®¹å¦‚ä¸‹ï¼š

```typescript
import i18next from 'i18next'
import { initReactI18next } from 'react-i18next'
import zhCNCOMMON from './locales/zh-CN/common.json'
import enUSCOMMON from './locales/en-US/common.json'
import zhCNAUTH from './locales/zh-CN/auth.json'
import enUSAUTH from './locales/en-US/auth.json'

i18next
  .use(initReactI18next) // passes i18n down to react-i18next
  .init({
    // é»˜è®¤è¯­è¨€
    lng: 'en-US',
    // å‘½ä»¤ç©ºé—´
    ns: ['COMMON', 'AUTh'],
    resources: {
      'zh-CN': {
        COMMON: zhCNCOMMON,
        AUTh: zhCNAUTH
      },
      'en-US': {
        COMMON: enUSCOMMON,
        AUTh: enUSAUTH
      }
    }
  })

```

## ä½¿ç”¨

å°† config.ts å¯¼å…¥åˆ°é¡¹ç›®çš„å…¥å£æ–‡ä»¶å°±å¯ä»¥ä½¿ç”¨äº†

è¿™é‡Œæ˜¯åœ¨ **main.tsx** å¯¼å…¥

```tsx
import './i18n/config.ts'
```

**APP.tsx** å†…å®¹å¦‚ä¸‹ï¼š

```tsx
import { useTranslation } from 'react-i18next'
function App() {
  const { t } = useTranslation('common')
  return (
    <>
      <div>{t('welcome')}</div>
    </>
  )
}

export default App
```

é¡µé¢ä¸­å°±å‡ºç°äº† **locales/en-US/common.json** é‡Œé¢çš„ **welcome** å€¼ã€‚

å¦‚æœä½ æƒ³åˆ‡æ¢è¯­è¨€ï¼Œä½¿ç”¨ **i18n.changeLanguage()** åˆ‡æ¢ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```tsx
import { useTranslation } from 'react-i18next'
function App() {
  const { t, i18n } = useTranslation('common')
  return (
    <>
      <div>{t('welcome')}</div>
      <button
        onClick={() => {
          const language = i18n.language === 'en-US' ? 'zh-CN' : 'en-US'
          i18n.changeLanguage(language)
        }}
      >
        åˆ‡æ¢
      </button>
    </>
  )
}

export default App
```

è¿™æ ·å°±å¯ä»¥ä¸­è‹±æ–‡æ¥å›åˆ‡æ¢äº†ã€‚

## TypeScript æ”¯æŒ

åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª **@types** æ–‡ä»¶å¤¹ï¼Œæ¥ç€åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ **i18n.d.ts** å’Œ **resources.ts**

resources.ts æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```ts
import AUTH from '../src/i18n/locales/en-US/auth.json'
import COMMON from '../src/i18n/locales/en-US/common.json'

const resources = {
  AUTH,
  COMMON
} as const

export default resources
```

è¿™é‡Œåªè¦å¯¼å…¥ä¸€ç§è¯­è¨€å°±è¡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†è®© typescript æä¾›æç¤º

ç„¶åéœ€è¦åœ¨ **i18n.d.ts** é…ç½®ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```ts
import resources from './resources'

declare module 'i18next' {
  interface CustomTypeOptions {
    defaultNS: 'en-US'
    resources: typeof resources
  }
}
```

 å†™å®Œäº†ä¹‹åå‘ç°å¹¶æ²¡æœ‰è·å–æç¤ºæ˜¯å› ä¸ºä½ æ²¡æœ‰åœ¨ **tsconfig.app.json** æ–‡ä»¶æ·»åŠ ç›¸å…³é…ç½®ï¼Œå¦‚ä¸‹ï¼š

```ts
  "include": ["src","@types"]
```

äºæ˜¯ vite å¹¶æ²¡æœ‰ç¼–è¯‘å®ƒï¼Œå› æ­¤ä¹Ÿä¸ä¼šæœ‰ **typescript** çš„æç¤ºå’Œç±»å‹æ£€æŸ¥ã€‚

## è¿›é˜¶å†…å®¹

è™½ç„¶å°†ç¿»è¯‘æ”¾åˆ° json ä¸­ï¼Œä½†æ˜¯è¿™ç§å¼•å…¥æ–¹å¼å¾ˆä¸èˆ’æœï¼Œæ¯æ¬¡æ–°å¢æ–°çš„è¯­è¨€ç¿»è¯‘å‘½åç©ºé—´éƒ½éœ€è¦å†™ä¸€ä¸ª importï¼Œå¦‚æœæä¾›å¤šä¸ªå‘½åç©ºé—´ç¿»è¯‘æˆ–è€…å¤šç§è¯­è¨€ï¼Œè¿™æ˜¯å¾ˆå¤´ç–¼çš„é—®é¢˜ã€‚

ç†æƒ³æƒ…å†µä¸‹åº”è¯¥èƒ½è‡ªåŠ¨ä» **locales** ä¸­è¯»å–æ¯ä¸ªè¯­è¨€å’Œæ¯ä¸ªå‘½ä»¤ç©ºé—´ï¼Œè‡ªåŠ¨ç”Ÿæˆ **resources** é…ç½®

ç°åœ¨å†™ä¸ªè„šæœ¬ **loadLangsToResources.ts**ï¼Œæ¥è¯»å–æ‰€æœ‰è¯­è¨€åŒ…ï¼Œå¹¶ä¸”å°†ä»–ä»¬è½¬æ¢ä¸ºå¯¹åº”çš„ **resources** æ•°æ®

> ä¸‹é¢çš„ import.meta.glob æ˜¯ vite æä¾›çš„æ–¹æ³•

```ts
// åŠ è½½æ‰€æœ‰çš„è¯­è¨€åŒ…æ–‡ä»¶
const modules = import.meta.glob('./locales/**/*.json', {
  eager: true
}) as Record<string, { default: never }>

// import.meta.glob:å…è®¸ä½¿ç”¨é€šé…ç¬¦çš„æ¨¡å¼æ¥å¯¼å…¥æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡å¯ä»¥ä½¿å…¶æŒ‰éœ€å¯¼å…¥ã€‚
// eager é€‰é¡¹ï¼šè®¾ç½®ä¸º true æ—¶ï¼Œæ¨¡å—ä¼šåœ¨æ„å»ºæ—¶ç«‹å³å¯¼å…¥ï¼ˆåº”ç”¨åŠ è½½æ—¶å°±é¢„åŠ è½½ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶æŒ‰éœ€å¯¼å…¥ã€‚

interface NObject {
  [key: string]: any
}

// Object.entries() è¿”å›ä¸€ä¸ªå±æ€§é”®å€¼å¯¹çš„æ•°ç»„
export const localeTransitions = Object.entries(modules).reduce((prev, current) => {
  const [path, module] = current

  const lang = path.match(/\/locales\/([\w-]+)\//)
  const filename = path.match(/\/([\w-_]+)\.json$/)
  if (filename && lang) {
    prev[lang[1]] = prev[lang[1]] || {}
    prev[lang[1]][filename[1].toUpperCase()] = module.default
  } else {
    console.error(`æ— æ³•è§£ææ–‡ä»¶åç§° path:${path}`)
  }
  return prev
}, {} as NObject)
```

é‡å†™ config.ts æ–‡ä»¶çš„å†…å®¹ï¼š

```ts
import i18next from 'i18next'
import { initReactI18next } from 'react-i18next'
import { localeTransitions } from './loadLangsToResouerce.ts'

i18next.use(initReactI18next).init({
  lng: 'en-US',
  debug: true,
  ns: Object.keys(localeTransitions),
  resources: localeTransitions
})
```

è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ‰‹åŠ¨å¯¼å…¥äº†ï¼Œè§£å†³äº†ä¸€å¤§éš¾é¢˜ï¼Œç°åœ¨ä¸ºä½ é¡¹ç›®æ·»åŠ å›½é™…åŒ–è¯•è¯•å§ï¼
